// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================
// GROUP / HIERARCHY STRUCTURE
// ============================================

model Group {
  id        Int      @id @default(autoincrement())
  slug      String?  @unique
  parentId  Int?
  level     Int      @default(0)
  order     Int      @default(0)
  scope     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parent   Group?  @relation("GroupHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children Group[] @relation("GroupHierarchy")

  translations     GroupTranslation[]
  contentRelations ContentGroup[]

  @@index([parentId])
  @@index([scope])
  @@index([level])
  @@map("groups")
}

model GroupTranslation {
  id        Int      @id @default(autoincrement())
  groupId   Int
  language  String
  title     String
  description String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, language])
  @@index([language])
  @@map("group_translations")
}

// ============================================
// CONTENT STRUCTURE
// ============================================

model Content {
  id           Int       @id @default(autoincrement())
  slug         String    @unique
  title        String
  subtitle     String?
  body         String?
  heroMediaId  String?
  order        Int       @default(0)
  isPublished  Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  heroMedia Media? @relation("HeroMedia", fields: [heroMediaId], references: [id], onDelete: SetNull)

  translations  ContentTranslation[]
  groups        ContentGroup[]
  media         ContentMedia[]
  externalLinks ContentExternalLink[]
  citations     ContentCitation[]
  feedbacks     Feedback[]
  similarFrom   ContentSimilar[] @relation("ContentSimilarFrom")
  similarTo     ContentSimilar[] @relation("ContentSimilarTo")
  faqs          FAQ[]

  @@index([isPublished])
  @@map("contents")
}

model ContentTranslation {
  id        Int      @id @default(autoincrement())
  contentId Int
  language  String
  title     String
  subtitle  String?
  body      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, language])
  @@index([language])
  @@map("content_translations")
}

model ContentGroup {
  id        Int      @id @default(autoincrement())
  contentId Int
  groupId   Int
  order     Int      @default(0)

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  group   Group   @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([contentId, groupId])
  @@index([groupId])
  @@map("content_groups")
}

// ============================================
// MEDIA MANAGEMENT
// ============================================

model Media {
  id               String   @id @default(cuid())
  filename         String
  originalFilename String
  mimeType         String
  size             Int
  path             String
  alt              String?
  width            Int?
  height           Int?
  source           String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  heroFor   Content[]     @relation("HeroMedia")
  contentMedia ContentMedia[]

  @@index([mimeType])
  @@map("media")
}

model ContentMedia {
  id        String   @id @default(cuid())
  contentId Int
  mediaId   String
  scope     String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  media   Media   @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([contentId, mediaId, scope])
  @@index([contentId])
  @@index([scope])
  @@map("content_media")
}

// ============================================
// EXTERNAL RESOURCES
// ============================================

model ContentExternalLink {
  id        String   @id @default(cuid())
  contentId Int
  url       String
  title     String?
  type      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([type])
  @@map("content_external_links")
}

model ContentCitation {
  id           String   @id @default(cuid())
  contentId    Int
  source       String
  documentDate DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  content Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@map("content_citations")
}

model ContentSimilar {
  id            String   @id @default(cuid())
  contentId     Int
  similarToId   Int
  createdAt     DateTime @default(now())

  content   Content @relation("ContentSimilarFrom", fields: [contentId], references: [id], onDelete: Cascade)
  similarTo Content @relation("ContentSimilarTo", fields: [similarToId], references: [id], onDelete: Cascade)

  @@unique([contentId, similarToId])
  @@index([similarToId])
  @@map("content_similar")
}

// ============================================
// USER INTERACTION
// ============================================

model Feedback {
  id         String   @id @default(cuid())
  contentId  Int
  userId     String
  userName   String?
  content    String
  rating     Int?
  isApproved Boolean  @default(false)
  isHelpful  Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  contentItem Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@index([contentId])
  @@index([userId])
  @@index([isApproved])
  @@map("feedback")
}

// ============================================
// ADDITIONAL FEATURES
// ============================================

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime?
  location    String?
  url         String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([startDate])
  @@index([isActive])
  @@map("events")
}

model SuccessStory {
  id          String   @id @default(cuid())
  title       String
  content     String   @db.LongText
  authorName  String?
  authorImage String?
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isPublished])
  @@map("success_stories")
}

model FAQ {
  id         String   @id @default(cuid())
  contentId  Int?
  question   String   @db.Text
  answer     String   @db.LongText
  language   String   @default("en")
  order      Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  content Content? @relation(fields: [contentId], references: [id], onDelete: SetNull)

  @@index([contentId])
  @@index([language])
  @@index([isActive])
  @@map("faqs")
}
